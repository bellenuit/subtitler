#tag ClassProtected Class SoftitlerConverterInherits cTitlelistConverter	#tag Event		Sub DoConvert(s as string)		  dim i,j,countlines,item as integer		  dim start, ende, tctext as string		  dim tit as ctitle		  dim separator as string		  dim line, lines(-1), titles(-1), title as string		  dim state, s2 , durationtext , starttext,endtext as string		  dim startfeet, startframes, endfeet, endframes as integer		  dim body as boolean		  dim timeformat as string		  		  		  tc.gauge 35		  		  s2 = replacelineEndings(s,endofLine)		  		  // remove L and replace I		  s2 = replaceall(s2,"[L]","")		  s2 = replaceall(s2,"[N]","")		  s2 = replaceall(s2,"[I]","<i>")		  s2 = replaceall(s2,"[/I]","</i>")		  		  lines = split(s2,endofline)		  countlines = ubound(titles)		  		  for each line in lines		    		    if body then		      if line = "[FOOTER]" then		        body = false		      elseif left(line,1) = "[" then		        line = replace(line,"[","")		        line = replace(line,"]","")		        tit = new ctitle		        tit.eventnr = val(line)		        state = "in"		      else		        select case state		        case "in"		          select case timeformat		          case "VIDEO"		            start = line		            tit.start = start		          else		            'startfeet = val(nthfield(line,".",2))		            'startframes = val(nthfield(line,".",3))		            'starttext = format(startfeet,"0") +"."+format(startframes,"00")		            'start = tc.tctotext(tc.feettotc(val(starttext)))		            start = NthField(line," ",1)		            tit.start = start		          end		          state = "out"		        case "out"		          select case timeformat		          case "VIDEO"		            ende = line		            tit.ende = ende		            titlelist.titles.append tit		          else		            'endfeet = val(nthfield(line,".",2))		            'endframes = val(nthfield(line,".",3))		            'endtext = format(endfeet,"0") +"."+format(endframes,"00")		            'ende = tc.tctotext(tc.feettotc(val(endtext)))		            start = NthField(line," ",1)		            tit.ende = ende		            titlelist.titles.append tit		          end		          state = "textline"		        case "textline"		          if instr(line,"<i>")>0 and  instr(line,"</i>")=0 then line = line + "</i>"		          if tit<>nil then tit.lines.append line		        end		      end		    else		      if instr(line,"TIME_FORMAT=PAL")>0 then		        timeformat = "VIDEO"		      end		      if instr(line,"TIME_FORMAT=NTSC")>0 then		        timeformat = "VIDEO"		      end		      if line = "[BODY]" then		        body = true		      end		    end		    		    i = i+1		    if i mod 10 = 0 then		      progress 33+66*i/countlines		    end		    if userCancelled then		      exit		    end		  next		  		  		  		  createedl uppercase(documentname),0,ubound(titlelist.titles) 		  		End Sub	#tag EndEvent	#tag Method, Flags = &h0		Sub Constructor()		  label = "Softitler"		End Sub	#tag EndMethod	#tag ViewBehavior		#tag ViewProperty			Name="binaryfile"			Group="Behavior"			InitialValue="0"			Type="boolean"			InheritedFrom="cTitlelistConverter"		#tag EndViewProperty		#tag ViewProperty			Name="charactercount"			Group="Behavior"			InitialValue="0"			Type="integer"			InheritedFrom="cTitlelistConverter"		#tag EndViewProperty		#tag ViewProperty			Name="clipnames"			Group="Behavior"			InitialValue="0"			Type="boolean"			InheritedFrom="cTitlelistConverter"		#tag EndViewProperty		#tag ViewProperty			Name="documentname"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"			InheritedFrom="cTitlelistConverter"		#tag EndViewProperty		#tag ViewProperty			Name="endline"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"			InheritedFrom="cTitlelistConverter"		#tag EndViewProperty		#tag ViewProperty			Name="framerate"			Group="Behavior"			InitialValue="0"			Type="double"			InheritedFrom="cTitlelistConverter"		#tag EndViewProperty		#tag ViewProperty			Name="Index"			Visible=true			Group="ID"			InitialValue="-2147483648"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="italicstring"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"			InheritedFrom="cTitlelistConverter"		#tag EndViewProperty		#tag ViewProperty			Name="label"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"			InheritedFrom="cTitlelistConverter"		#tag EndViewProperty		#tag ViewProperty			Name="Left"			Visible=true			Group="Position"			InitialValue="0"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Name"			Visible=true			Group="ID"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Super"			Visible=true			Group="ID"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Top"			Visible=true			Group="Position"			InitialValue="0"			InheritedFrom="Object"		#tag EndViewProperty	#tag EndViewBehaviorEnd Class#tag EndClass