#tag ClassProtected Class RtfEditFieldInherits TextareaImplements RtfTarget	#tag Method, Flags = &h0		Sub Export(target as RtfTarget)		  dim st as RtfState		  dim i as integer		  		  if progress <> nil then		    progress.maximum = 100		  end		  		  if not target.preprocess then		    return		  end		  		  selstart = 1		  		  st = getstate		  		  if st = nil then		    msgbox "st nil in rtfeditfield"		  end		  		  target.setstate st		  target.write left(text,1)		  		  for i = 2 to len(text)		    if userCancelled then		      exit		    end		    		    if progress <> nil and i mod 100 = 0 then		      progress.value = i*100/len(text)		    end		    		    selstart = i		    if stylechanged(st) then		      st = getstate		      target.setstate st		    end		    		    target.write mid(text,i,1)		  next		  		  if not target.postprocess then		    return		  end		  		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Function GetState() As rtfstate		  dim st as RtfState		  st = new RtfState		  st.font = seltextfont		  st.textsize = seltextsize		  st.foregroundcolor = seltextcolor		  st.bold = selbold		  st.italic = selitalic		  st.underline = selunderline		  //change 1.1		  #if targetmacOS then		    if selextend then		      st.expanded = 3		    elseif selcondense then		      st.expanded = -3		    else		      st.expanded = 0		    end		    st.outline = seloutline		    st.shadow = selshadow		  #endif		  //change 1.1		  // comment this out if you are using RB 3		  st.alignment = selalignment		  // end comment this out if you are using RB 3		  return st		End Function	#tag EndMethod	#tag Method, Flags = &h0		Function Postprocess() As Boolean		  WriteBuffer		  top = oldtop		  		  		  selstart = 0		  seltext = ""		  		  		  return true		End Function	#tag EndMethod	#tag Method, Flags = &h0		Function Preprocess() As Boolean		  oldtop = top		  top  = window.height+1		  text = ""		  currentstate = new rtfstate		  return true		End Function	#tag EndMethod	#tag Method, Flags = &h0		Sub SetState(st as RtfState)		  writebuffer		  		  currentstate = st		  seltextfont = st.font		  seltextsize = st.textsize		  seltextcolor = st.foregroundcolor		  selbold = st.bold		  selitalic = st.italic		  selunderline = st.underline		  //change 1.1		  #if targetmacOS then		    if st.expanded > 0 then		      selextend = true		      selcondense = false		    elseif st.expanded < 0 then		      selextend = false		      selcondense = true		    else		      selextend = false		      selcondense = false		    end		    seloutline = st.outline		    selshadow = st.shadow		  #endif		  //change 1.1		  // comment this out if you are using RB 3		  if st.alignment<4 then		    selalignment = st.alignment		  else		    selalignment = 1		  end		  // end comment this out if you are using RB 3		  		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Function StyleChanged(st as RtfState) As boolean		  		  if seltextfont <> st.font then		    return true		  end		  if st.textsize <> seltextsize then		    return true		  end		   if  st.foregroundcolor <> seltextcolor then		    return true		  end		  if st.bold <> selbold then		    return true		  end		  if  st.italic <> selitalic then		    return true		  end		  if st.underline <> selunderline then		    return true		  end		  		  //change 1.1		  #if targetmacOS then		    if  st.outline <> seloutline then		      return true		    end		    if  st.shadow <> selshadow then		      return true		    end		    select case st.expanded\1		    case 3		      if not selextend then		        return true		      end		    case 0		      if selextend or selcondense then		        return true		      end		    case -3		      if not selcondense then		        return true		      end		    end		  #endif		  		  // change 1.1		  // comment this out if you are using RB 3		  select case st.alignment		  case 4		    if not (selalignment = 1) then		      return true		    end		  else		    if not (st.alignment = selalignment) then		      return true		    end		  end		  // end comment this out if you are using RB 3		  		  return false		  		End Function	#tag EndMethod	#tag Method, Flags = &h0		Sub Version()		  // 1.2 20.2.3 editfield goes to start at end 		  // 1.1 support for selalignment in carbon and win builds		  // 1.0a2 8.11.00		  // added Preprocess and Postprocess		  // fixed bug setting colors		  // fixed bug added currentstyle instance at preprocess time		  // buffered writing		  // support for progressbar		   // 1.0a1 14.10.00		  		  		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub Write(t as string)		  buffer = buffer+t		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub WriteBuffer()		  dim oldseltextsize,i, len  as integer		  dim t as string		  		  if buffer = "" then		    return		  end		  		  		  if  currentstate.smallcapitals then		    len = len(buffer)		    for i = 1 to len		      t = mid(buffer,i,1)		      if strcomp(t,uppercase(t),0)=0 then		        seltext = t		      else		        oldseltextsize = seltextsize		        seltextsize = ceil(seltextsize * 0.8) //well, should be x-height		        seltext = uppercase(t)		        seltextsize = oldseltextsize		      end		    next		  elseif currentstate.capitals then		    seltext = uppercase(buffer)		  else		    seltext = buffer		  end		  		  buffer = ""		End Sub	#tag EndMethod	#tag Property, Flags = &h0		buffer As string	#tag EndProperty	#tag Property, Flags = &h0		currentstate As RtfState	#tag EndProperty	#tag Property, Flags = &h0		oldtop As integer	#tag EndProperty	#tag Property, Flags = &h0		progress As progressbar	#tag EndProperty	#tag ViewBehavior		#tag ViewProperty			Name="AcceptTabs"			Visible=true			Group="Behavior"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="Alignment"			Visible=true			Group="Behavior"			InitialValue="0"			Type="Integer"			EditorType="Enum"			InheritedFrom="EditField"			#tag EnumValues				"0 - Default"				"1 - Left"				"2 - Center"				"3 - Right"			#tag EndEnumValues		#tag EndViewProperty		#tag ViewProperty			Name="AutoDeactivate"			Visible=true			Group="Appearance"			InitialValue="True"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="AutomaticallyCheckSpelling"			Visible=true			Group="Behavior"			InitialValue="True"			Type="boolean"			InheritedFrom="Textarea"		#tag EndViewProperty		#tag ViewProperty			Name="BackColor"			Visible=true			Group="Appearance"			InitialValue="&hFFFFFF"			Type="Color"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="Bold"			Visible=true			Group="Font"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="Border"			Visible=true			Group="Appearance"			InitialValue="True"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="buffer"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"		#tag EndViewProperty		#tag ViewProperty			Name="DataField"			Visible=true			Group="Database Binding"			Type="String"			EditorType="DataField"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="DataSource"			Visible=true			Group="Database Binding"			Type="String"			EditorType="DataSource"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="Enabled"			Visible=true			Group="Appearance"			InitialValue="True"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="Format"			Visible=true			Group="Appearance"			Type="String"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="Height"			Visible=true			Group="Position"			InitialValue="22"			Type="Integer"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="HelpTag"			Visible=true			Group="Appearance"			Type="String"			EditorType="MultiLineEditor"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="HideSelection"			Visible=true			Group="Appearance"			InitialValue="True"			Type="Boolean"			InheritedFrom="Textarea"		#tag EndViewProperty		#tag ViewProperty			Name="Index"			Visible=true			Group="ID"			Type="Integer"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="Italic"			Visible=true			Group="Font"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="Left"			Visible=true			Group="Position"			Type="Integer"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="LimitText"			Visible=true			Group="Behavior"			InitialValue="0"			Type="Integer"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="LockBottom"			Visible=true			Group="Position"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="LockLeft"			Visible=true			Group="Position"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="LockRight"			Visible=true			Group="Position"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="LockTop"			Visible=true			Group="Position"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="Mask"			Visible=true			Group="Behavior"			Type="String"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="Multiline"			Visible=true			Group="Appearance"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="Name"			Visible=true			Group="ID"			Type="String"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="oldtop"			Group="Behavior"			InitialValue="0"			Type="integer"		#tag EndViewProperty		#tag ViewProperty			Name="ReadOnly"			Visible=true			Group="Behavior"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="ScrollbarHorizontal"			Visible=true			Group="Appearance"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="ScrollbarVertical"			Visible=true			Group="Appearance"			InitialValue="True"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="Styled"			Visible=true			Group="Appearance"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="Super"			Visible=true			Group="ID"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="TabIndex"			Visible=true			Group="Position"			InitialValue="0"			Type="Integer"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="TabPanelIndex"			Group="Position"			InitialValue="0"			Type="Integer"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="TabStop"			Visible=true			Group="Position"			InitialValue="True"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="Text"			Visible=true			Group="Initial State"			Type="String"			EditorType="MultiLineEditor"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="TextColor"			Visible=true			Group="Appearance"			InitialValue="&h000000"			Type="Color"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="TextFont"			Visible=true			Group="Font"			InitialValue="System"			Type="String"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="TextSize"			Visible=true			Group="Font"			InitialValue="0"			Type="Integer"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="TextUnit"			Visible=true			Group="Font"			InitialValue="0"			Type="FontUnits"			EditorType="Enum"			InheritedFrom="Textarea"			#tag EnumValues				"0 - Default"				"1 - Pixel"				"2 - Point"				"3 - Inch"				"4 - Millimeter"			#tag EndEnumValues		#tag EndViewProperty		#tag ViewProperty			Name="Top"			Visible=true			Group="Position"			Type="Integer"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="Underline"			Visible=true			Group="Font"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="UseFocusRing"			Visible=true			Group="Appearance"			InitialValue="True"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="Visible"			Visible=true			Group="Appearance"			InitialValue="True"			Type="Boolean"			InheritedFrom="EditField"		#tag EndViewProperty		#tag ViewProperty			Name="Width"			Visible=true			Group="Position"			InitialValue="80"			Type="Integer"			InheritedFrom="EditField"		#tag EndViewProperty	#tag EndViewBehaviorEnd Class#tag EndClass