#tag ClassProtected Class LocalizationDictClassInherits Dictionary	#tag Method, Flags = &h0		Sub Load(source as string, language as string)		  dim xdoc as xmldocument		  dim xelem as xmlelement		  dim recordnode, node, textnode as xmlnode		  dim i,j,k,ci,cj,ck as integer		  dim key, v, text, englishtext, v0,s,s2 as string		  dim line as integer		  dim source2 as string		  		  //filter out all low characters		  source2 =source		  for i = 0 to &h1F		    select case i		    case &h9, &hA, &hD		    else		      source2 = replaceall(source2,chr(i),"")		    end		  next		  		  		  //test create an error:		  'source2 = chr(&h1F)+source2 		  		  source2 = source2.defineEncoding(encodings.utf8)		  		  		  xdoc = new xmldocument(source2)		  xelem = xdoc.documentElement		  		  if not (xelem.name = "lang") then return		  		  ci = xelem.childcount-1		  for i = 0 to ci		    recordnode = xelem.child(i)		    if recordnode.name = "record" then		      cj = recordnode.childcount -1		      key = ""		      v = ""		      v0 = ""		      for j = 0 to cj		        text = ""		        node = recordnode.child(j)		        ck = node.childcount-1		        for k = 0 to ck		          textnode = node.child(k)		          if textnode.type = 3 then // textnode 		            text = textnode.value		            exit		          end		        next		        select case node.name		        case "key"		          key = text		        case "english"		          //use for default		          englishtext = text		          if language = "english" then v = text		        case language		          v = text		        end		      next		      if key<>"" then		        if v<>"" then		          me.value(key) = v		        elseif englishtext<>"" then		          me.value(key) = englishtext		        else 		          me.value(key) = key		        end		      end		    end		  next		  		  		Exception err As XmlException		  s2 = replacelineEndings(source2,endofLine)		  line = val(nthField(err.line,":",2))		  s = "Error XMLDictionary.LoadXML XMLException" + endofLine + endofLine		  s = s + err.line+ nthfield(s2,endofLine,line) + endofLine		  s = s + "after " + nthfield(s2,endofLine,line-1)  + endofLine		  s = s + "before " + nthfield(s2,endofLine,line+1)  + endofLine		  s = s + "node " + err.node  + endofline 		  s = s + "token " + err.token + endofline		  s = s + "error " + str(err.errorNumber) + ":" + err.Message + endofline		  s = s + "Please send file to developer (matti@belle-nuit.com)"		  msgBox s		  // Ugh, invalid XML		  		End Sub	#tag EndMethod	#tag ViewBehavior		#tag ViewProperty			Name="BinCount"			Group="Behavior"			InitialValue="0"			Type="Integer"			InheritedFrom="Dictionary"		#tag EndViewProperty		#tag ViewProperty			Name="Count"			Group="Behavior"			InitialValue="0"			Type="Integer"			InheritedFrom="Dictionary"		#tag EndViewProperty		#tag ViewProperty			Name="Index"			Visible=true			Group="ID"			InitialValue="-2147483648"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Left"			Visible=true			Group="Position"			InitialValue="0"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Name"			Visible=true			Group="ID"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Super"			Visible=true			Group="ID"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Top"			Visible=true			Group="Position"			InitialValue="0"			InheritedFrom="Object"		#tag EndViewProperty	#tag EndViewBehaviorEnd Class#tag EndClass