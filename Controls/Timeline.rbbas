#tag ClassProtected Class TimelineInherits Canvas	#tag Event		Function MouseDown(X As Integer, Y As Integer) As Boolean		  mousedownEvent		  return true		End Function	#tag EndEvent	#tag Event		Sub MouseUp(X As Integer, Y As Integer)		  dim pos as double		  		  position = x2pos(x)		  		  if duration <> 0 then		    positionevent position		  end		  		  redraw		End Sub	#tag EndEvent	#tag Event		Sub Paint(g As Graphics)		  redraw		End Sub	#tag EndEvent	#tag Method, Flags = &h0		Sub BuildWaveform()		  dim g as graphics		  dim i, ub as integer		  waveform = newpicture(width-2*kheadroom,2*kmarkheight,32)		  waveform.graphics.forecolor = rgb(0,0,0)		  waveform.graphics.fillrect 0,0,width,height		  		  g = waveform.mask.graphics		  g.clearrect 0,0,width,height		  g.foreColor = rgb(0,0,0)		  ub = ubound(map)		  for i = 0 to ub		    if map(i)<>0 then		      g.drawline i,0,i,2*kmarkheight		    end		  next		  		  		Exception err as OutOfBoundsException		  MsgBox "OutOfBoundsException in Timeline.BuildWaveform"		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Function InitMapSize() As integer		  redim map(width - 2 * kheadroom - 1)		  return ubound(map)		End Function	#tag EndMethod	#tag Method, Flags = &h0		Function Pos2X(pos as double) As integer		  if duration <> 0 then		    return ( pos / duration ) * (width - 2 * kheadroom) + kheadroom		  end		End Function	#tag EndMethod	#tag Method, Flags = &h0		Sub Redraw()		  dim x as integer		  dim gr,g as graphics		  dim buffer as picture		  		  g = graphics		  		  'if targetcarbon then		  'gr = g		  'else		  buffer = newpicture(width,height,32)		  gr = buffer.graphics		  'end		  		  		  gr.foreColor = rgb(0,0,0)		  gr.penheight = 1		  gr.penwidth = 1		  gr.drawline kheadroom,height/2,width-kheadroom,height/2		  gr.drawline kheadroom,height/2-kmarkheight,kheadroom,height/2 + kmarkheight		  gr.drawline width-kheadroom,height/2 - kmarkheight,width-kheadroom,height/2 + kmarkheight		  		  if waveform <> nil then		    gr.drawpicture waveform, kheadroom,height/2-kmarkheight		  end		  		  		  if duration > 0 then		    gr.foreColor = rgb(128,128,255)		    x = pos2x(position)		    gr.drawline x, 0, x, height		  end		  		  		  		  'if not targetcarbon then		  g.drawpicture buffer,0,0		  'end		  		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Function X2Pos(x as integer) As double		  if duration <> 0 then		    if x < kheadroom then return 0		    if x > width-kheadroom then return duration		    return ( x - kheadroom ) / (width - 2 * kheadroom) * duration		  end		End Function	#tag EndMethod	#tag Hook, Flags = &h0		Event MouseDownEvent()	#tag EndHook	#tag Hook, Flags = &h0		Event PositionEvent(pos as double)	#tag EndHook	#tag Property, Flags = &h0		duration As double	#tag EndProperty	#tag Property, Flags = &h0		map(-1) As integer	#tag EndProperty	#tag Property, Flags = &h0		position As double	#tag EndProperty	#tag Property, Flags = &h0		waveform As picture	#tag EndProperty	#tag Constant, Name = kheadroom, Type = Integer, Dynamic = False, Default = \"10", Scope = Public	#tag EndConstant	#tag Constant, Name = kmarkheight, Type = Integer, Dynamic = False, Default = \"3", Scope = Public	#tag EndConstant	#tag ViewBehavior		#tag ViewProperty			Name="AcceptFocus"			Visible=true			Group="Behavior"			Type="Boolean"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="AcceptTabs"			Visible=true			Group="Behavior"			Type="Boolean"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="AutoDeactivate"			Visible=true			Group="Appearance"			InitialValue="True"			Type="Boolean"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="Backdrop"			Visible=true			Group="Appearance"			Type="Picture"			EditorType="Picture"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="DoubleBuffer"			Visible=true			Group="Behavior"			InitialValue="False"			Type="Boolean"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="duration"			Group="Behavior"			InitialValue="0"			Type="double"		#tag EndViewProperty		#tag ViewProperty			Name="Enabled"			Visible=true			Group="Appearance"			InitialValue="True"			Type="Boolean"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="EraseBackground"			Visible=true			Group="Behavior"			InitialValue="True"			Type="Boolean"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="Height"			Visible=true			Group="Position"			InitialValue="100"			Type="Integer"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="HelpTag"			Visible=true			Group="Appearance"			Type="String"			EditorType="MultiLineEditor"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="Index"			Visible=true			Group="ID"			Type="Integer"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="InitialParent"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="Left"			Visible=true			Group="Position"			Type="Integer"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="LockBottom"			Visible=true			Group="Position"			Type="Boolean"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="LockLeft"			Visible=true			Group="Position"			Type="Boolean"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="LockRight"			Visible=true			Group="Position"			Type="Boolean"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="LockTop"			Visible=true			Group="Position"			Type="Boolean"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="Name"			Visible=true			Group="ID"			Type="String"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="position"			Group="Behavior"			InitialValue="0"			Type="double"		#tag EndViewProperty		#tag ViewProperty			Name="Super"			Visible=true			Group="ID"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="TabIndex"			Visible=true			Group="Position"			InitialValue="0"			Type="Integer"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="TabPanelIndex"			Group="Position"			InitialValue="0"			Type="Integer"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="TabStop"			Visible=true			Group="Position"			InitialValue="True"			Type="Boolean"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="Top"			Visible=true			Group="Position"			Type="Integer"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="UseFocusRing"			Visible=true			Group="Appearance"			InitialValue="True"			Type="Boolean"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="Visible"			Visible=true			Group="Appearance"			InitialValue="True"			Type="Boolean"			InheritedFrom="Canvas"		#tag EndViewProperty		#tag ViewProperty			Name="waveform"			Group="Behavior"			InitialValue="0"			Type="picture"		#tag EndViewProperty		#tag ViewProperty			Name="Width"			Visible=true			Group="Position"			InitialValue="100"			Type="Integer"			InheritedFrom="Canvas"		#tag EndViewProperty	#tag EndViewBehaviorEnd Class#tag EndClass