#tag ClassProtected Class SAMIExporterInherits TitleExporterBN	#tag Event		Function ExportEvent() As string		  dim lines(-1), result, textlines(-1) as string		  dim inp, outp, t as string		  dim tab as string		  dim title as onetitle		  dim extra, extrastyles(-1), extratext ,par as string		  dim i,r,g,b as integer		  dim tc as timecode		  dim c as color		  		  		  tc = gettimeCode		  		  tab = chr(9)		  		  		  		  lines.append "<SAMI>"		  lines.append "<Title>"+Latin2HTML(documentname)+"</Title>"		  lines.append "<Head>"		  		  lines.append tab+ "<SAMIParam>"		  lines.append tab+tab +"Program {(C) Belle Nuit Subtitler " + app.shortVersion + "}"		  lines.append tab+tab + "Media {"+getmoviefilename+"}"		  lines.append tab+tab +"Metrics {time:ms; duration:"  + format(getmovieDuration*1000,"0") +"}"		  lines.append tab+tab +"Spec {MSFT:1.0;}"		  lines.append tab+"</SAMIParam>"		  		  lines.append tab +"<STYLE TYPE = ""text/css""><!--"		  		  lines.append tab + tab + "P { "		  lines.append tab + tab + tab + "margin-left: " + str(style.left.value) +"px; "		  lines.append tab + tab + tab + "margin-right: "+ str(style.widthreal-style.right.value) +"px; " 		  lines.append tab + tab + tab + "margin-top: " + str(style.ver.value - 1.5 * style.size) + "px; "		  lines.append tab + tab + tab +  "margin-bottom: " + str(style.height - style.ver.value - 1.5* style.size) +"px; " 		  lines.append tab + tab + tab + "font-family: " + style.font+ ", sans-serif; " 		  lines.append tab + tab + tab + "font-size: " +str(style.size) +"; " 		  if style.bold then		    lines.append tab + tab + tab + "font-weight: bold; " 		  end		  if style.italic then		    lines.append tab + tab + tab + "font-style: italic; " 		  end		  lines.append tab + tab + tab + "color: " + style.textc.htmlvalue +";" 		  if style.rectalpha>0 then		    lines.append tab + tab + tab + "background-color: " + style.rectc.htmlvalue+";" 		  end		  select case style.halign		  case style.kHalignLeft		    lines.append tab + tab + tab + "text-align: left;"		  case style.kHalignCenter		    lines.append tab + tab + tab + "text-align: center;"		  case style.khalignRight		    lines.append tab + tab + tab + "text-align: right;"		  case style.KHalignCenterLeft		    lines.append tab + tab + tab + "text-align: center;"		  end		  lines.append tab + tab + tab + "}"		  		  lines.append tab + "--></STYLE>"		  		  		  lines.append "</Head"		  		  		  lines.Append "<Body>"		  		  for each title in titles		    if title.getinpoint<>"" and title.getoutpoint<>"" then		      inp = title.getinPoint		      if inp<>outp then		        tc.settext inp		        lines.append tab + "<SYNC Start=" + format(tc.getTotalSeconds*1000,"0") + ">"		      end		      extratext = ""		      extrastyles = title.getextraStyle		      for each extra in extrastyles		        select case extra		        case "bold"		          extratext = extratext+"font-weight: bold; "		        case "italic"		          extratext = extratext+"font-style: italic; "		        case "underline"		          extratext = extratext+"text-decoration: underline; "		        case "plain"		          extratext = extratext+"font-weight: normal; font-style: normal; text-decoration: none; "		        case "left"		          extratext = extratext+"text-align: left; "		        case "center"		          extratext = extratext+"text-align: center; "		        case "right"		          extratext = extratext+"text-align: right; "		        else		          if nthField(extra,"(",1) = "color" then		            par = nthfield(nthfield(extra,"(",2),")",1)		            r = val(nthfield(par,",",1))		            g = val(nthfield(par,",",2))		            b = val(nthfield(par,",",3))		            c = rgb(r,g,b)		            extratext = extratext+"color "+c.htmlvalue + "; "		          end		        end		      next		      textlines = split(title.gettext,endofLine)		      if ubound(textlines)>-1 then		        if extratext<>"" then 		          lines.append  tab + tab +"<P><DIV style="""+extratext + """>" + Latin2HTML(textlines(0))		        else		          lines.append tab + tab + "<P>"+Latin2HTML(textlines(0))		        end		        for i = 1 to ubound(textlines)		          lines.append tab + tab + Latin2HTML(t)		        next		        if extratext<>""then 		          lines.append  tab + tab +"</DIV>"		        end		      end		      outp = title.getoutPoint		      tc.settext outp		      lines.append tab + "<SYNC Start=" + format(tc.getTotalSeconds*1000,"0") + ">"		      		    end		  next		  		  		  lines.append "</Body>"		  lines.append "</SAMI>"		  		  result = join(lines,endofLine.windows)		  		  return result		  		  		End Function	#tag EndEvent	#tag Event		Function GetDefaultNameEvent() As string		  return documentname + ".smi"		End Function	#tag EndEvent	#tag Event		Function GetDefaultPathEvent() As folderitem		  return exportfolder		End Function	#tag EndEvent	#tag Event		Function GetLabelEvent() As string		  return "SAMI"		End Function	#tag EndEvent	#tag ViewBehavior		#tag ViewProperty			Name="documentname"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"			InheritedFrom="TitleExporterBN"		#tag EndViewProperty		#tag ViewProperty			Name="dumpstring"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"			InheritedFrom="TitleExporterBN"		#tag EndViewProperty		#tag ViewProperty			Name="Index"			Visible=true			Group="ID"			InitialValue="-2147483648"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Left"			Visible=true			Group="Position"			InitialValue="0"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="moviename"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"			InheritedFrom="TitleExporterBN"		#tag EndViewProperty		#tag ViewProperty			Name="Name"			Visible=true			Group="ID"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Super"			Visible=true			Group="ID"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Top"			Visible=true			Group="Position"			InitialValue="0"			InheritedFrom="Object"		#tag EndViewProperty	#tag EndViewBehaviorEnd Class#tag EndClass