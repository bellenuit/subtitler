#tag ClassProtected Class Subtitler110ExporterBNInherits TitleExporterBN	#tag Event		Function ExportEvent() As string		  if mainwindow<>nil then		    left = mainwindow.left		    top = mainwindow.top		    width = mainwindow.width		    height = mainwindow.height		    titlelist = mainwindow.titlelist		    exportformat = mainwindow.exportformat		    folderpath = mainwindow.folderpath		    pagesetup = mainwindow.pageSetup		  end		  return savedocument		End Function	#tag EndEvent	#tag Event		Function GetCreatorEvent() As string		  return "SICT"		End Function	#tag EndEvent	#tag Event		Function GetDefaultNameEvent() As string		  return documentname + " 110.stp"		End Function	#tag EndEvent	#tag Event		Function GetLabelEvent() As string		  return "Subtitler 1.1"		End Function	#tag EndEvent	#tag Event		Function GetTypeEvent() As string		  return "STLI"		End Function	#tag EndEvent	#tag Event		Function IsBinaryEvent() As boolean		  return true		End Function	#tag EndEvent	#tag Method, Flags = &h0		Function savedocument() As string		  dim b as ramStream		  dim m as memoryblock		  dim i,u,v as integer		  dim numberofentries, dataoffset,startstyle, pos, startheadings, starttitles  as integer		  dim diroffset as integer		  dim unencoded,utf8string as string		  dim conv as textConverter		  dim sd as saveAsDialog		  		  b = new ramstream(32000)		  		  b.write "SICT"		  b.write "STLI" 		  b.writeshort 3//version		  		  diroffset = 20		  numberOfEntries = 10 		  dataoffset = diroffset+2+12*(numberofentries+1)		  		  b.writelong diroffset		  		  for i= b.position to dataoffset		    b.writebyte 0		  next		  		  b.position(diroffset)		  b.writeshort numberOfEntries		  diroffset = b.position		  		  b.position(diroffset)		  writetag(b,256,3,4,dataoffset) //docwindow		  diroffset = b.position		  b.position(dataoffset)		  b.writeshort left		  b.writeshort top		  b.writeshort width		  b.writeshort height		  dataoffset = b.position		  		  b.position(diroffset)		  writetag(b,257,3,4,dataoffset)  //monitorwindow		  diroffset = b.position		  b.position(dataoffset)		  b.writeshort app.settingsleft		  b.writeshort app.settingstop		  dataoffset = b.position		  		  b.position(diroffset)		  writetag(b,258,3,2,dataoffset) //settingswindow		  diroffset = b.position		  b.position(dataoffset)		  b.writeshort app.monitorleft		  b.writeshort app.monitortop		  dataoffset = b.position		  		  b.position(diroffset)		  writetag(b,259,3,2,dataoffset) //registerwindow		  diroffset = b.position		  b.position(dataoffset)		  b.writeshort app.registerleft		  b.writeshort app.registertop		  dataoffset = b.position		  		  b.position(diroffset)		  writetag(b,271,2,1,dataoffset) //exportformat		  diroffset = b.position		  b.position(dataoffset)		  b.writepstring exportformat		  dataoffset = b.position		  		  b.position(diroffset)		  writetag(b,512,10,1,dataoffset)		  diroffset = b.position		  b.position(dataoffset)		  m = style.backup		  u = m.short(0)		  for i = 0 to u-1 		    b.writebyte m.byte(i)		  next		  dataoffset = b.position		  		  b.position(diroffset)		  writetag(b,513,2,1,dataoffset) //folderprpath		  diroffset = b.position		  b.position(dataoffset)		  b.writepstring folderpath		  dataoffset = b.position		  		  b.position(diroffset)		  writetag(b,514,2,1,dataoffset) //pagesetup		  diroffset = b.position		  b.position(dataoffset)		  b.writepstring pagesetup		  dataoffset = b.position		  		  b.position(diroffset)		  writetag(b,1025,2,1,dataoffset) //encoding 		  diroffset = b.position		  b.position(dataoffset)		  b.writepstring "utf8"		  dataoffset = b.position		  		  b.position(diroffset)		  writetag(b,1026,18,1,dataoffset)		  diroffset = b.position		  b.position(dataoffset)		  unencoded = titlelist.text  // assume...		  		  conv = gettextconverter(guessjapaneseencoding(unencoded),gettextencoding(&h0100,0,2))		  utf8string = replaceall(conv.convert(unencoded),endofLine.macintosh,endofLine.macintosh)		  		  v=lenb(utf8string)		  b.writelong v		  b.write utf8string		  dataoffset = b.position		  		  b.position(diroffset)		  writetag(b,0,0,0,0)		  		  		  b.position(0)		  return b.read(dataoffset)		  		  		End Function	#tag EndMethod	#tag Method, Flags = &h0		Sub writetag(b as ramstream,  tag as integer,type as integer,size as integer, value as integer)		  		  b.writeshort tag		  b.writeshort type		  b.writelong size		  if type = 3 and size = 1then		    b.writeshort value		    b.writeshort 0		  else		    b.writelong value		  end if		  		End Sub	#tag EndMethod	#tag Note, Name = MenuHandler					#tag EndNote	#tag Property, Flags = &h0		exportformat As string	#tag EndProperty	#tag Property, Flags = &h0		folderpath As string	#tag EndProperty	#tag Property, Flags = &h0		height As integer	#tag EndProperty	#tag Property, Flags = &h0		left As integer	#tag EndProperty	#tag Property, Flags = &h0		pagesetup As string	#tag EndProperty	#tag Property, Flags = &h0		titlelist As edittitle	#tag EndProperty	#tag Property, Flags = &h0		top As integer	#tag EndProperty	#tag Property, Flags = &h0		width As integer	#tag EndProperty	#tag ViewBehavior		#tag ViewProperty			Name="documentname"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"			InheritedFrom="TitleExporterBN"		#tag EndViewProperty		#tag ViewProperty			Name="dumpstring"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"			InheritedFrom="TitleExporterBN"		#tag EndViewProperty		#tag ViewProperty			Name="exportformat"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"		#tag EndViewProperty		#tag ViewProperty			Name="folderpath"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"		#tag EndViewProperty		#tag ViewProperty			Name="height"			Group="Behavior"			InitialValue="0"			Type="integer"		#tag EndViewProperty		#tag ViewProperty			Name="Index"			Visible=true			Group="ID"			InitialValue="-2147483648"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Left"			Visible=true			Group="Position"			InitialValue="0"			Type="integer"		#tag EndViewProperty		#tag ViewProperty			Name="moviename"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"			InheritedFrom="TitleExporterBN"		#tag EndViewProperty		#tag ViewProperty			Name="Name"			Visible=true			Group="ID"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="pagesetup"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"		#tag EndViewProperty		#tag ViewProperty			Name="Super"			Visible=true			Group="ID"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Top"			Visible=true			Group="Position"			InitialValue="0"			Type="integer"		#tag EndViewProperty		#tag ViewProperty			Name="width"			Group="Behavior"			InitialValue="0"			Type="integer"		#tag EndViewProperty	#tag EndViewBehaviorEnd Class#tag EndClass