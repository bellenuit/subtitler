#tag ClassProtected Class BNDExporterInherits TitleExporterBN	#tag Event		Function ExportEvent() As string		  dim i,j,cf as integer		  dim tapeoffset as boolean		  dim lines(-1), eventlines(-1), result, inp, outp, dur as string		  dim title as onetitle		  dim tcstart, tcend, durtc, offsettc as timecode		  dim w, h, ht, y as integer		  dim widthBND, heightBND,languagecode, videoformatBND, framerateBND, dropframeBND, lasteventoutTC, firsteventinTC, contentinTC, contentoutTC, numberofeventsstring as string		  		  languagecode = "eng"		  		  select case style.standard		  case "PAL", "PAL 16:9", "PAL DVD"		    videoformatBND = "576i"		  case "NTSC", "NTSC 16:9", "NTSC DVD", "NTSC DV", "NTSC 16:9 DV"		    videoformatBND = "480i"		  case "VGA"		    videoformatBND = "480p"		  case "HD 720p"		    videoformatBND = "720p"		  case "HD 1080p"		    videoformatBND = "1080p"		  case "HD 1080i","HDV 1080i"		    videoformatBND = "1080i"		  case "iPod"		    videoformatBND = "480p"		  case "iPod 16:9"		    videoformatBND = "480p"		  end select		  		  dropframeBND = "false"		  select case style.framerate		  case "23.98"		    framerateBND = "23.976"		  case "24"		    framerateBND = "24"		  case "25"		    framerateBND = "25"		  case "29.97 DF"		    framerateBND = "29.97"		    dropframeBND = "true"		  case "29.97 NDF"		    framerateBND = "29.97"		  case "30"		    framerateBND = "30"		  end		  		  firsteventinTC = "23:59:59:24"		  lasteventoutTC = "00:00:00:00"		  		  tcstart = gettimeCode		  tcend = gettimeCode		  offsettc = getmovieoffset		  		  for each title in titles		    widthBND =str(self.style.width)		    heightBND =str(self.style.height)		    lasteventoutTC = max(lasteventoutTC,title.GetOutPoint)		    firsteventinTC = min(firsteventinTC,title.GetInPoint)		    eventlines.append "   <Event Forced=""False"" InTC="""+title.GetInPoint+""" OutTC="""+title.GetOutPoint+""">"		    eventlines.append "      <Graphic Width="""+widthBND+""" Height="""+heightBND+""" X=""0"" Y=""0"">"+title.FilenameComplete+"</Graphic>"		    eventlines.append "   </Event>"		  next		  		  contentinTC = firsteventinTC		  contentoutTC = lasteventoutTC		  numberofeventsstring = str(ubound(titles)+1)		  		  lines.append "<?xml version=""1.0"" encoding=""UTF-8""?>"		  lines.append "<!-- created by Belle Nuit Subtitler " + app.ShortVersion + " -->"		  lines.append "<BDN Version=""0.93"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xsi:noNamespaceSchemaLocation=""BD-03-006-0093b BDN File Format.xsd"">"		  lines.append "<Description>"		  lines.append "   <Name Title=""" + replace(documentname,"""","'") + """ Content=""""/>"		  lines.append "   <Language Code="""+languagecode+"""/>"		  lines.append "   <Format VideoFormat=""" + videoformatBND +""" FrameRate="""+framerateBND +""" DropFrame="""+dropframeBND+"""/>"		  lines.append "   <Events LastEventOutTC="""+lasteventoutTC + """ FirstEventInTC="""+firsteventinTC+""" ContentInTC="""+contentinTC+""" ContentOutTC="""+contentouttc+""" NumberofEvents="""+numberofeventsstring+""" Type=""Graphic""/>"		  lines.append "</Description>"		  lines.append "<Events>"		  		  lines.append join(eventlines,EndOfLine.windows)		  		  lines.append "</Events>"		  lines.append "</BDN>"		  		  		  result = join(lines,endofline)		  return result		End Function	#tag EndEvent	#tag Event		Function GetDefaultDictEvent() As dictionary		  dim d as new dictionary		  return d		End Function	#tag EndEvent	#tag Event		Function GetDefaultNameEvent() As string		  return documentname + ".xml"		End Function	#tag EndEvent	#tag Event		Function GetDefaultPathEvent() As folderitem		  return exportfolder		End Function	#tag EndEvent	#tag Event		Function GetLabelEvent() As string		  return "Blue Ray BDN"		End Function	#tag EndEvent	#tag Event		Sub ImportEvent(s as string)		  '<?xml version="1.0" encoding="UTF-8"?>		  '<!-- Created by Captions, Inc. (version 0.8) -->		  '<BDN Version="0.90" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="BD-03-006-0092b BDN File Format.xsd">		  '<Description>		  '<Name Title="&quot;Cat O&#x2019;Nine Tails, The (BD) - Feature&quot; / 16x9 Letterbox 2.35 / HD-24 / 16x9 2.35 / ENGLISH FORCED / HD / CATONINETAIL / Blue Underground, Inc. / CI_WO_182548"/>		  '<Language Code="eng"/>		  '<Format VideoFormat="1080p" FrameRate="23.976" DropFrame="false"/>		  '<Events Type="Graphic" CharacterCode="1" FirstEventInTC="10:07:57:12" LastEventOutTC="11:25:13:06" NumberofEvents="13"/>		  '</Description>		  '<Events>		  '<Event Forced="true" InTC="10:07:57:12" OutTC="10:07:59:05">		  '<Graphic Width="266" Height="53" X="826" Y="873">CAEF0001.PNG</Graphic>		  '</Event>		  '<Event Forced="true" InTC="10:08:39:17" OutTC="10:08:41:21">		  '<Graphic Width="1107" Height="125" X="403" Y="801">CAEF0002.PNG</Graphic>		  '</Event>		  '<Event Forced="true" InTC="10:11:44:10" OutTC="10:11:46:03">		  '<Graphic Width="277" Height="53" X="824" Y="873">CAEF0003.PNG</Graphic>		  '</Event>		  '<Event Forced="true" InTC="10:13:40:00" OutTC="10:13:41:23">		  '<Graphic Width="266" Height="53" X="826" Y="873">CAEF0004.PNG</Graphic>		  '</Event>		  '<Event Forced="true" InTC="10:31:40:03" OutTC="10:31:42:02">		  '<Graphic Width="855" Height="53" X="531" Y="873">CAEF0005.PNG</Graphic>		  '</Event>		  '<Event Forced="true" InTC="10:48:25:10" OutTC="10:48:28:07">		  '<Graphic Width="615" Height="125" X="652" Y="801">CAEF0006.PNG</Graphic>		  '</Event>		  '<Event Forced="true" InTC="10:54:40:21" OutTC="10:54:44:02">		  '<Graphic Width="1146" Height="137" X="386" Y="801">CAEF0007.PNG</Graphic>		  '</Event>		  '<Event Forced="true" InTC="10:54:44:04" OutTC="10:54:46:15">		  '<Graphic Width="885" Height="125" X="515" Y="801">CAEF0008.PNG</Graphic>		  '</Event>		  '<Event Forced="true" InTC="10:54:46:17" OutTC="10:54:49:10">		  '<Graphic Width="1093" Height="125" X="413" Y="139">CAEF0009.PNG</Graphic>		  '</Event>		  '<Event Forced="true" InTC="10:59:33:11" OutTC="10:59:36:02">		  '<Graphic Width="441" Height="53" X="741" Y="873">CAEF0010.PNG</Graphic>		  '</Event>		  '<Event Forced="true" InTC="11:16:45:04" OutTC="11:16:48:08">		  '<Graphic Width="1021" Height="125" X="450" Y="139">CAEF0011.PNG</Graphic>		  '</Event>		  '<Event Forced="true" InTC="11:23:04:14" OutTC="11:23:05:22">		  '<Graphic Width="293" Height="53" X="812" Y="873">CAEF0012.PNG</Graphic>		  '</Event>		  '<Event Forced="true" InTC="11:25:11:15" OutTC="11:25:13:06">		  '<Graphic Width="428" Height="53" X="748" Y="873">CAEF0013.PNG</Graphic>		  '</Event>		  '</Events>		  '</BDN>		  		  dim v,position, position0, position2, dummy, itemstart, effectstart, starttcframes, item, countlines as integer		  dim starttc, dummystring, startframes, endframes, effectname, titletext, effectcategory, tagparameter, parameterstring, subtitletagcontent, fonttagccontent, halign as string		  dim itemstring as string		  dim title as onetitle		  dim st as Subtitle		  dim currentitalic, firstline as boolean		  		  // matti		  v = instr(s,"<?xml")		  if  v = 0 or v > 80 then		    msgbox "This is not an XML document"		    return		  end		  		  // we will use our own parser.		  		  countlines = max(countfields(s,"<generatoritem"),1)		  		  redim titles(-1)		  		  		  		  while GetNextItem(position,s,"Event",subtitletagcontent,parameterstring)		    		    startframes = GetParameter(parameterstring,"InTC")		    tc.SetText startframes		    startframes = tc.GetText		    endframes = GetParameter(parameterstring,"OutTC")		    tc.SetText endframes		    endframes = tc.GetText		    		    title = new oneTitle(style)		    title.SetInOut(startframes,endframes)		    		    		    position2=0		    firstline = true		    if GetNextItem(position2,subtitletagcontent,"Graphic",dummystring, parameterstring) then		      itemstring = replace(dummystring,".PNG","")		      title.SetFilename itemstring		    end		    		    titles.append title		    position = position + 1		  wend		  		  		  		  		  		  		  		  		  		  		  		End Sub	#tag EndEvent	#tag ViewBehavior		#tag ViewProperty			Name="documentname"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"			InheritedFrom="TitleExporterBN"		#tag EndViewProperty		#tag ViewProperty			Name="dumpstring"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"			InheritedFrom="TitleExporterBN"		#tag EndViewProperty		#tag ViewProperty			Name="Index"			Visible=true			Group="ID"			InitialValue="-2147483648"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Left"			Visible=true			Group="Position"			InitialValue="0"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="moviename"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"			InheritedFrom="TitleExporterBN"		#tag EndViewProperty		#tag ViewProperty			Name="Name"			Visible=true			Group="ID"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Super"			Visible=true			Group="ID"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Top"			Visible=true			Group="Position"			InitialValue="0"			InheritedFrom="Object"		#tag EndViewProperty	#tag EndViewBehaviorEnd Class#tag EndClass